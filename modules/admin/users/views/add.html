<div class="row small-spacing">
  <div class="col-md-12 col-xs-12">
    <div class="box-content">
      <h4 class="box-title"><%=__('admin.system.add')%></h4>
      <div class="dropdown js__drop_down">
        <a href="<%= active_list_url%>" type="button" class="btn btn btn-violet">
            <i class="ico ico-left fa fa-step-backward"></i>
            <%=__('admin.system.back')%>
        </a>
      </div>
      <hr />
      <div class="card-content">
        <form id="add-user" method="post" name="add-user" data-submit-btn-id="add-btn-user" enctype="multipart/form-data">
          <div class="row">
            <div class="col-md-6">
              <div class="col-md-12">
                <label for="profile_picture">
                  <%= __('admin.user.profile_picture')%>
                </label>
                <div class="form-group text-center">
                  <div class="upload-btn-wrapper">
                    <input name="image" type="file" id="input-file-now-custom-1" class="dropify" data-default-file="<%= NO_IMAGE_URL%>" />
                    <span class="error" id="image_error"></span>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group col-md-12">
                <label for="first_name">
                  <%= __('admin.user.full_name')%>
                  <span class="required">*</span>
                </label>
                <input type="text" class="form-control" name="full_name"
                  id="full_name" />
                <span class="error" id="full_name_error"></span>
              </div>
              <div class="form-group col-md-12">
                <label for="phone">
                  <%= __('admin.user.phone_number')%>
                  <span class="required">*</span>
                </label>
                <input type="tel" class="form-control" name="phone" id="phone" />
                <input type="hidden" class="form-control" name="country_code" id="country_code" />
                <input type="hidden" class="form-control" name="dial_code" id="dial_code" />
                <span class="error" id="phone_error"></span>
              </div>
              <div class="form-group col-md-12">
                <label for="user_name">
                  <%= __('admin.user.user_name')%>
                  <span class="required">*</span>
                </label>
                <input type="text" class="form-control" name="user_name" id="user_name" />
                <span class="error" id="user_name_error"></span>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="form-group col-md-6">
              <label for="interest">
                <%= __('admin.user.interest')%>
                <span class="required">*</span>
              </label>
              <select class="form-control" name="interest" id="interest">
                <option><%= __('admin.user.select_interest')%></option>
                <%- interest%>
              </select>
              <span class="error" id="interest_error"></span>
            </div>
            <div class="form-group col-md-6">
              <label for="gender">
                <%= __('admin.user.gender')%>
                <span class="required">*</span>
              </label>
              <select class="form-control" name="gender" id="gender">
                <option>Select gender</option>
              </select>
              <span class="error" id="gender_error"></span>
            </div>
          </div>

          <div class="row">
            <div class="form-group col-md-6">
              <label for="date_of_birth">
                <%= __('admin.user.date_of_birth')%>
                <span class="required">*</span>
              </label>
              <input type="date" class="form-control" name="date_of_birth" id="date_of_birth" />
              <span class="error" id="date_of_birth_error"></span>
            </div>
            <div class="form-group col-md-6">
              <label for="facebook">
                <%= __('admin.user.facebook')%>
                <span class="required">*</span>
              </label>
              <input type="text" class="form-control" name="facebook" id="facebook"/>
              <span class="error" id="facebook_error"></span>
            </div>
          </div>

          <div class="row">
            <div class="form-group col-md-6">
              <label for="instagram">
                <%= __('admin.user.instagram')%>
                <span class="required">*</span>
              </label>
              <input type="text" class="form-control" name="instagram" id="instagram"/>
              <span class="error" id="instagram_error"></span>
            </div>
            <div class="form-group col-md-6">
              <label for="youtube">
                <%= __('admin.user.youtube')%>
                <span class="required">*</span>
              </label>
              <input type="text" class="form-control" name="youtube" id="youtube"/>
              <span class="error" id="youtube_error"></span>
            </div>
          </div>
          <div class="row">
            <div class="form-group col-md-6">
              <label for="country">
                <%= __('admin.user.country')%>
                <span class="required">*</span>
              </label>
              <select class="form-control select2-container" name="country" id="country">
                <option value=""><%= __('admin.user.select_country')%></option>
                <%- country%>
              </select>
              <span class="error" id="country_error"></span>
            </div>
            <div class="form-group col-md-6">
              <label for="zipcode">
                <%= __('admin.user.zipcode')%>
                <span class="required">*</span>
              </label>
              <input type="text" class="form-control" name="zipcode" id="zipcode"/>
              <span class="error" id="zipcode_error"></span>
            </div>
          </div>
          <div class="row">
            <div class="form-group col-md-6">
              <label for="user_bio">
                <%= __('admin.user.user_bio')%>
                <span class="required">*</span>
              </label>
              <textarea type="text" class="form-control flex-wrap" name="user_bio" id="user_bio"></textarea>
              <span class="error" id="user_bio_error"></span>
            </div>
            <div class="form-group col-md-6">
              <label for="upload_image2"><%= __('admin.user.images') %></label>
              
              <div class="container-fluid" style="border:1px solid #cecece; min-height: 105px;">
                <div class="inp_container col-md-2 col-sm-4">
                  <input type="file" class="custom_input_file" name="upload_image" id="upload_image" multiple="multiple"/> 
                  <label for="upload_image" class="custom_input_file_btn">
                    <i class="menu-icon fa fa-plus"></i>
                  </label>
                </div>
                <div class="inp_container col-md-10">
                  <div id="selectedImages_preview" style="display: none;"></div>
                  <div id="selectedImagesContainer" class="flex-wrap" style="display: none;"></div>
                </div>
                <a href="javascript:void(0)" onclick="removeAllImages()" id="remove_images" style="display: none;" class="remove-all-btn"><i class="ico ico-left fa fa-remove"></i></a>
                
              </div>
              <span class="error" id="upload_image_error"></span>
            </div>
          </div>
          <div class="row">
            <div class="form-group col-md-6">
              <label for="password">
                <%= __('admin.user.password')%>
                <span class="required"> *</span>
              </label>
              <input type="password" class="form-control" name="password" id="password"/>
              <span class="error" id="password_error"></span>
            </div>
 
            <div class="form-group col-md-6">
              <label for="confirm_password">
                <%= __('admin.user.confirm_password')%>
                <span class="required">*</span>
              </label>
              <input type="password" class="form-control" name="confirm_password" id="confirm_password" />
              <span class="error" id="confirm_password_error"></span>
            </div>
          </div>
          <a href="#" type="button" id="add-btn-user" class="btn btn-success btn btn-submit">
            <i class="ico ico-left fa fa-save"></i>
            <%= __('admin.system.submit')%>
          </a>
          <a href="<%= active_list_url%>" type="button" class="btn btn-danger btn">
            <i class="ico ico-left fa fa-remove"></i>
            <%= __('admin.system.cancel')%>
          </a>
        </form>
      </div>
    </div>
  </div>
</div>

<script src="<%=WEBSITE_JS_FILE_PATH%>scripts/jquery-3.0.0.js"></script>

<!-- Select2 -->
<link
  rel="stylesheet"
  href="<%= WEBSITE_JS_FILE_PATH%>plugin/select2/css/select2.min.css"
/>
<script src="<%= WEBSITE_JS_FILE_PATH%>plugin/select2/js/select2.min.js"></script>

<!-- Dropify -->
<link
  rel="stylesheet"
  href="<%= WEBSITE_JS_FILE_PATH%>plugin/dropify/css/dropify.min.css"
/>
<script src="<%= WEBSITE_JS_FILE_PATH%>plugin/dropify/js/dropify.min.js"></script>
<script src="<%= WEBSITE_JS_FILE_PATH%>scripts/fileUpload.demo.min.js"></script>

<!-- Intl tel-->
<link
  rel="stylesheet"
  href="<%= WEBSITE_JS_FILE_PATH%>plugin/intlTel/css/intlTelInput.min.css"
/>
<link
  rel="stylesheet"
  href="<%= WEBSITE_JS_FILE_PATH%>plugin/intlTel/css/demo.css"
/>
<script src="<%= WEBSITE_JS_FILE_PATH%>plugin/intlTel/js/intlTelInput.min.js"></script>
<script>
  var input = document.querySelector("#phone");
  var iti = window.intlTelInput(input, {
    // any initialisation options go here
    formatOnDisplay: false,
    separateDialCode: true,
    utilsScript: "<%= WEBSITE_JS_FILE_PATH%>plugin/intlTel/js/utils.js",
  });

  // submit loader detail
  $(".btn-submit").click(function () {
    var country = iti.getSelectedCountryData();
    var countryCode = country.iso2 ? country.iso2 : "";
    var dialCode = country.dialCode ? country.dialCode : "";
    $("#country_code").val(countryCode);
    $("#dial_code").val(dialCode);
    var btnId = $(this).attr("id");
    startTextLoading(btnId);
    submit_multipart_form("add-user", function (status, response) {
      if (status) {
        window.location.href = response.rediect_url;
      } else {
        stopTextLoading(btnId);
      }
    });
  });

  $(document).ready(function(){
    $("#country, #interest").select2( {
      allowClear: true
    });
  })

  // ======== product multiple images 
  // image/jpeg
  var selectedImages=[];
  if(document.getElementById('upload_image')){
    document.getElementById('upload_image').addEventListener('input',function(){
      let files=[...this.files];
      // selectedImages=files;
      files.forEach((file)=>{
        selectedImages.push(file);
      })
      if(selectedImages.length<=5){
        
        // for check file type ====>
        let checkType=new Promise(function(resolve,resect){
          let is_fileType_ok=false;
          for(let i=0;i<selectedImages.length;i++){
          if(selectedImages[i].type=="image/jpeg" || selectedImages[i].type=="image/jpg" || selectedImages[i].type=="image/png" || selectedImages[i].type=="image/gif"){
            
            $('#upload_image_error').text('');
            is_fileType_ok=true;
          }else{
            is_fileType_ok=false;
            selectedImages=[];
            document.getElementById('upload_image').files=new FileListItems(selectedImages);
            $('#upload_image_error').text('You can upload only images.');
            break;
          }
          }
          resolve(is_fileType_ok);
        });
          // for check file size ====>
          checkType.then(function(data){
            if(data){
              renderImages(selectedImages);
            }
          })
  
          $('#upload_image_error').text('');
      }else{
        selectedImages=[];
        document.getElementById('upload_image').files=new FileListItems(selectedImages);
        $('#upload_image_error').text('You can upload max 5 images.');
      }
      checkRemoveAll();
    });
  }

  function renderImages(files){
    document.getElementById('upload_image').files=new FileListItems(selectedImages);
    let imageWrapper=$('#selectedImagesContainer');
    imageWrapper.html('');
    files.forEach((file,i)=>{
      getBase64(file).then((data)=> { 
        let string='<div class="image_box"> <img src="'+data+'" alt=""> <a href="javascript:void(0)" onclick="removeImage('+i+')" class="delete_btn"><i class="ico ico-left fa fa-remove"></i></a> </div>';
        imageWrapper.append(string);
      });
    });
    checkRemoveAll();
  }

  function getBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = () => resolve(reader.result);
      reader.onerror = error => reject(error);
    });
  }

  function removeImage(index){
    let images=document.getElementsByClassName('image_box');
    images[index].remove();
    selectedImages.splice(index,1);
    reArrangeIndex(selectedImages);
    document.getElementById('upload_image').files=new FileListItems(selectedImages);
    checkRemoveAll();
  }
  
  function reArrangeIndex(files){
    let btns=[...document.querySelectorAll('.image_box .delete_btn')];
    btns.forEach((btn,i)=>{
      btn.setAttribute('onclick','removeImage('+i+')');
    });
  }
  function FileListItems (files) {
  var b = new ClipboardEvent("").clipboardData || new DataTransfer();
  for (var i = 0; i<files.length; i++) {
    b.items.add(files[i]);
  }
  return b.files;
}
function removeAllImages(){
  selectedImages=[];
  document.getElementById('upload_image').files=new FileListItems(selectedImages);
  document.getElementById('selectedImagesContainer').innerHTML="";
  checkRemoveAll();
}
function checkRemoveAll(){
  let hideBtn=document.getElementById('remove_images');
  if(document.getElementById('upload_image').files.length>1){
    hideBtn.style.display="flex";
  }else{
    hideBtn.style.display="none";
  }
  if(document.getElementById('upload_image').files.length>0){
    document.getElementById('selectedImagesContainer').style.display="flex";
  }else{
    document.getElementById('selectedImagesContainer').style.display="none";
  }
}
// product multiple images ======== 
  
</script>
